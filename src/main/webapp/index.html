<!DOCTYPE html>
<html>
 <head>
   <title>2048</title>
   <meta charset="utf-8">
   <script type="text/javascript" src="jquery-1.11.3.min.js"></script>
   <link href="style/main.css" rel="stylesheet" type="text/css">
	 <link rel="shortcut icon" href="favicon.ico">
	 <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0, maximum-scale=1, user-scalable=no, minimal-ui">

 </head>
 <body>


<div class="container">
	<div class="heading">
		<h1 class="title">2048</h1>
		<div class="scores-container">
			<div class="score-container">0</div>
			<div class="best-container">0</div>
		</div>
	</div>

	<div class="above-game">
		<p class="game-intro">Join the numbers and get to the <strong>2048 tile!</strong></p>
		<a class="restart-button" onclick="runGame('NewGame')">New Game</a>
	</div>

	<div class="game-container">
		<div class="game-message">
			<p></p>
			<div class="lower">
				<a class="keep-playing-button">Keep going</a>
				<a class="retry-button">Try again</a>
			</div>
		</div>

		<div class="grid-container">
			<div class="grid-row">
				<div class="grid-cell"></div>
				<div class="grid-cell"></div>
				<div class="grid-cell"></div>
				<div class="grid-cell"></div>
			</div>
			<div class="grid-row">
				<div class="grid-cell"></div>
				<div class="grid-cell"></div>
				<div class="grid-cell"></div>
				<div class="grid-cell"></div>
			</div>
			<div class="grid-row">
				<div class="grid-cell"></div>
				<div class="grid-cell"></div>
				<div class="grid-cell"></div>
				<div class="grid-cell"></div>
			</div>
			<div class="grid-row">
				<div class="grid-cell"></div>
				<div class="grid-cell"></div>
				<div class="grid-cell"></div>
				<div class="grid-cell"></div>
			</div>
		</div>

		<div class="tile-container">

		</div>
	</div>

	<p class="game-explanation">
		<strong class="important">How to play:</strong> Use your <strong>arrow keys</strong> to move the tiles. When two tiles with the same number touch, they <strong>merge into one!</strong>
	</p>
	<hr>
	<p>
		<strong class="important">Note:</strong> This site is the official version of 2048. You can play it on your phone via <a href="http://git.io/2048">http://git.io/2048.</a> All other apps or sites are derivatives or fakes, and should be used with caution.
	</p>
	<hr>
	<p>
		Created by <a href="http://gabrielecirulli.com" target="_blank">Gabriele Cirulli.</a> Based on <a href="https://itunes.apple.com/us/app/1024!/id823499224" target="_blank">1024 by Veewo Studio</a> and conceptually similar to <a href="http://asherv.com/threes/" target="_blank">Threes by Asher Vollmer.</a>
	</p>
</div>

<!--<script src="js/bind_polyfill.js"></script>
<script src="js/classlist_polyfill.js"></script>
<script src="js/animframe_polyfill.js"></script>
<script src="js/keyboard_input_manager.js"></script>
<script src="js/html_actuator.js"></script>
<script src="js/grid.js"></script>
<script src="js/tile.js"></script>
<script src="js/local_storage_manager.js"></script>
<script src="js/game_manager.js"></script>
<script src="js/application.js"></script>-->


<script type="text/javascript">
jQuery(document).on('keydown',function(event){

	if(event.keyCode == 38 || event.keyCode == 40)
		event.preventDefault();
	var direction;
	if(event.keyCode == 27){
		direction = "NewGame";
		<!--direction = 0;-->
	}
	else if(event.keyCode == 38){
		direction = "UP";
		<!--direction = 1;-->
	}
	else if(event.keyCode == 39){
		direction = "RIGHT";
		<!--direction = 2;-->
	}
	else if(event.keyCode == 40){
		direction = "DOWN";
		<!--direction = 3;-->
	}
	else if(event.keyCode == 37){
		direction = "LEFT";
		<!--direction = 4;-->
	}

	if(direction == "UP" || direction == "RIGHT" || direction == "DOWN" || direction == "LEFT" || direction == "NewGame") {
	<!--if(direction >= 0 && direction <= 4){-->
		runGame(direction);
	}
});


function parseAnswer(JSONString) {

	var answerObject = JSON.parse(JSONString);
	var tileArray 		= answerObject.tiles;
	var currentScore 	= answerObject.currentScore;
	var bestScore 		= answerObject.bestScore;

	for(var t=0; t<tileArray.length; t++){

			var tile = {
						"x"     : tileArray[t].x,
						"y"     : tileArray[t].y,
						"value" : tileArray[t].value,
	  					"prevX" : tileArray[t].prevX,
	  					"prevY" : tileArray[t].prevY,
	  					"merged": tileArray[t].merged
					   };

			addTile(tile);
	}

}


function positionClassF(position) {
  position = normalizePosition(position);
  return "tile-position-" + position.x + "-" + position.y;
};

function normalizePosition(position) {
  return { x: position.x + 1, y: position.y + 1 };
};

function applyClasses(element, classes) {
  element.setAttribute("class", classes.join(" "));
};


function addTile(tile){
  var wrapper   = document.createElement("div");
  var inner     = document.createElement("div");
  
var position = {x:0,y:0};
if (tile.prevX || tile.prevY) {
	position.x = tile.prevX;
	position.y = tile.prevY;
}else{
	position.x = tile.x;
	position.y = tile.y;
}
  var positionClass = positionClassF(position);
  var classes = ["tile", "tile-" + tile.value, positionClass];

  if (tile.value > 2048) classes.push("tile-super");

  applyClasses(wrapper, classes);

  inner.classList.add("tile-inner");
  inner.textContent = tile.value;

  if (tile.prevX || tile.prevY) {
    // Make sure that the tile gets rendered in the previous position first
    window.requestAnimationFrame(function () {
      classes[2] = positionClassF({ x: tile.x, y: tile.y });
      applyClasses(wrapper, classes); // Update the position
    });
  } else if (tile.merged) {

    classes.push("tile-merged");
    /*
    applyClasses(wrapper, classes);
    tile.mergedFrom.forEach(function (merged) {
      self.addTile(merged);
    });
	*/

  } else {
    classes.push("tile-new");
    applyClasses(wrapper, classes);
  }

  // Add the inner part of the tile to the wrapper
  wrapper.appendChild(inner);
  // Put the tile on the board
  var tileContainer = document.querySelector(".tile-container");
  tileContainer.appendChild(wrapper);
};




$(document).ready(runGame(0));

function runGame(direction){
	$.ajax({
	  method  : "POST",
	  url     : "/2048/start",
	  data    : {
	  	direction: direction
	  },
	  success : function(answer){
	  	<!--jQuery("#mes").html(answer);-->
	  	var tileContainer = document.querySelector(".tile-container");
		tileContainer.innerHTML = "";
	  	parseAnswer(answer);
	  }

	});
}

</script>
 </body> 
</html>
